<section class="p-4 sm:p-6 space-y-5">
  <div class="text-center space-y-1">
    <h2 class="text-2xl font-semibold text-ink">Sign {{ mode() === 'signup' ? 'up' : 'in' }}</h2>
    </div>

  <div class="rounded-full bg-surface-muted/60 p-1 flex">
    <button type="button"
            class="flex-1 rounded-full py-2 text-sm font-semibold transition"
            [class.bg-surface]="selectedRole() === 'patient'"
            [class.text-ink]="selectedRole() === 'patient'"
            (click)="selectRole('patient')">
      Patient
    </button>
    <button type="button"
            class="flex-1 rounded-full py-2 text-sm font-semibold transition"
            [class.bg-surface]="selectedRole() === 'provider'"
            [class.text-ink]="selectedRole() === 'provider'"
            (click)="selectRole('provider')">
      Provider
    </button>
  </div>

  <div class="flex justify-center">
    <button class="text-xs text-brand font-semibold underline" (click)="toggleMode()">
      {{ mode() === 'signup' ? 'Have an account? Sign in' : 'New here? Create account' }}
    </button>
  </div>

  <form class="space-y-3" (ngSubmit)="submit()" [formGroup]="onboardingForm">
    <div class="error-banner" *ngIf="errorMessage()">
      {{ errorMessage() }}
    </div>
    <label class="field" *ngIf="mode() === 'signup'">
      <span>Display name</span>
      <input formControlName="displayName" type="text" class="input" placeholder="Mama Asha" autocomplete="name">
    </label>

    <label class="field">
      <span>Email</span>
      <input formControlName="email" type="email" class="input" placeholder="you@email.com" autocomplete="email">
    </label>

    <label class="field">
      <span>Password</span>
      <input formControlName="password" type="password" class="input" [attr.autocomplete]="mode() === 'signup' ? 'new-password' : 'current-password'">
      </label>

    <div class="grid grid-cols-2 gap-3">
      <label class="field">
        <span>Language</span>
        <select formControlName="language" class="input">
          <option value="en">English</option>
          <option value="sw">Swahili</option>
        </select>
      </label>
      <label class="field" *ngIf="mode() === 'signup'">
        <span>Phone</span>
        <input formControlName="phone" type="tel" class="input" placeholder="+255...">
      </label>
    </div>

    <label class="field" *ngIf="selectedRole() === 'patient' && mode() === 'signup'">
      <span>Year of birth</span>
        <input formControlName="yearOfBirth" type="number" min="1930" max="2020" class="input">
      </label>

    <div class="rounded-2xl border border-border/70 p-3 space-y-2 text-sm" *ngIf="selectedRole() === 'patient' && mode() === 'signup'" formGroupName="conditions">
      <div class="flex items-center justify-between text-xs uppercase tracking-wide">
        <span class="text-muted">Conditions</span>
        <span class="text-brand font-semibold">Code: {{ onboardingForm.get('shareCode')?.value || '••••••' }}</span>
      </div>
      <div class="flex gap-4">
        <label class="chip">
          <input type="checkbox" formControlName="hypertension" class="checkbox">
          BP
        </label>
        <label class="chip">
          <input type="checkbox" formControlName="diabetes" class="checkbox">
          Sugar
        </label>
      </div>
    </div>

    <div class="space-y-2 pt-2">
      <button type="submit" class="pill-button w-full text-lg">
        {{ mode() === 'signup' ? 'Create account' : 'Continue' }}
      </button>
      <button type="button" class="pill-button pill-button--accent w-full text-lg" (click)="continueWithGoogle()">
        Continue with Google
      </button>
    </div>
  </form>
</section>
