<div class="space-y-6 p-4 md:p-6">
  <button
    type="button"
    class="mb-2 flex items-center gap-2 px-4 py-2 bg-surface rounded-xl shadow-md text-brand font-semibold hover:shadow-lg transition-shadow"
    (click)="cancel()">
    <span class="text-2xl">←</span>
    <span>{{ 'common.back' | translate }}</span>
  </button>

  <div class="space-y-2">
    <h2 class="text-2xl font-bold text-ink">{{ 'provider.registerPatient' | translate }}</h2>
    <p class="text-sm text-muted">{{ 'provider.registerPatientDescription' | translate }}</p>
  </div>

  <!-- Success State -->
  <div *ngIf="status() === 'success' && createdPatient()" class="bg-green-50 border border-green-200 rounded-2xl p-6 space-y-4">
    <div class="flex items-start gap-3">
      <span class="text-3xl">✅</span>
      <div class="flex-1">
        <h3 class="text-lg font-bold text-green-900 mb-2">{{ 'provider.patientRegistered' | translate }}</h3>
        <div class="bg-white rounded-xl p-4 space-y-2 text-sm">
          <p class="font-semibold text-ink">{{ 'provider.shareCredentials' | translate }}</p>
          <div class="space-y-2">
            <div>
              <span class="text-muted">{{ 'auth.email' | translate }}:</span>
              <span class="font-mono font-semibold text-ink ml-2">{{ createdPatient()?.email }}</span>
            </div>
            <div>
              <span class="text-muted">{{ 'auth.password' | translate }}:</span>
              <span class="font-mono font-semibold text-ink ml-2">{{ createdPatient()?.password }}</span>
            </div>
          </div>
          <p class="text-xs text-muted mt-3 pt-3 border-t border-border/40">
            {{ 'provider.patientCanLoginLater' | translate }}
          </p>
        </div>
      </div>
    </div>
    <div class="flex gap-3">
      <button type="button" class="pill-button flex-1" (click)="viewPatient()">
        {{ 'provider.viewPatient' | translate }}
      </button>
      <button type="button" class="pill-button-secondary flex-1" (click)="registerAnother()">
        {{ 'provider.registerAnother' | translate }}
      </button>
    </div>
  </div>

  <!-- Registration Form -->
  <form *ngIf="status() !== 'success'" class="space-y-4" (ngSubmit)="submit()" [formGroup]="registrationForm">
    <div class="error-banner" *ngIf="errorMessage()">
      {{ errorMessage() }}
    </div>

    <label class="field">
      <span>{{ 'auth.displayName' | translate }} <span class="text-danger">*</span></span>
      <input formControlName="displayName" type="text" class="input" placeholder="Mama Asha" autocomplete="name">
      <p class="text-xs text-danger mt-1" *ngIf="registrationForm.get('displayName')?.touched && registrationForm.get('displayName')?.errors?.['required']">
        {{ 'common.required' | translate }}
      </p>
    </label>

    <label class="field">
      <span>{{ 'auth.email' | translate }} <span class="text-danger">*</span></span>
      <input formControlName="email" type="email" class="input" placeholder="patient@example.com" autocomplete="email">
      <p class="text-xs text-danger mt-1" *ngIf="registrationForm.get('email')?.touched && registrationForm.get('email')?.errors?.['email']">
        {{ 'common.invalidEmail' | translate }}
      </p>
      <p class="text-xs text-muted mt-1">{{ 'provider.emailForLogin' | translate }}</p>
    </label>

    <label class="field">
      <span>{{ 'auth.password' | translate }} <span class="text-danger">*</span></span>
      <input formControlName="password" type="password" class="input" autocomplete="new-password">
      <p class="text-xs text-muted mt-1">{{ 'provider.passwordForLogin' | translate }}</p>
      <p class="text-xs text-danger mt-1" *ngIf="registrationForm.get('password')?.touched && registrationForm.get('password')?.errors?.['minlength']">
        {{ 'common.minLength' | translate: {min: 6} }}
      </p>
    </label>

    <div class="grid grid-cols-2 gap-3">
      <label class="field">
        <span>{{ 'auth.language' | translate }} <span class="text-danger">*</span></span>
        <select formControlName="language" class="input">
          <option value="en">{{ 'languages.en' | translate }}</option>
          <option value="sw">{{ 'languages.sw' | translate }}</option>
        </select>
      </label>
      <label class="field">
        <span>{{ 'auth.phone' | translate }}</span>
        <input formControlName="phone" type="tel" class="input" placeholder="+255...">
      </label>
    </div>

    <label class="field">
      <span>{{ 'auth.yearOfBirth' | translate }}</span>
      <input formControlName="yearOfBirth" type="number" min="1930" max="2020" class="input">
    </label>

    <div class="rounded-2xl border border-border/70 p-4 space-y-3" formGroupName="conditions">
      <p class="text-sm font-semibold text-ink">{{ 'auth.conditions' | translate }}</p>
      <label class="flex items-center gap-2 cursor-pointer">
        <input type="checkbox" formControlName="hypertension" class="w-5 h-5">
        <span class="text-sm text-ink">{{ 'conditions.hypertension' | translate }}</span>
      </label>
      <label class="flex items-center gap-2 cursor-pointer">
        <input type="checkbox" formControlName="diabetes" class="w-5 h-5">
        <span class="text-sm text-ink">{{ 'conditions.diabetes' | translate }}</span>
      </label>
    </div>

    <div class="flex gap-3 pt-4">
      <button type="button" class="pill-button-secondary flex-1" (click)="cancel()" [disabled]="status() === 'loading'">
        {{ 'common.cancel' | translate }}
      </button>
      <button type="submit" class="pill-button flex-1" [disabled]="status() === 'loading'">
        <span *ngIf="status() === 'loading'">{{ 'common.registering' | translate }}...</span>
        <span *ngIf="status() !== 'loading'">{{ 'provider.registerPatient' | translate }}</span>
      </button>
    </div>
  </form>
</div>

