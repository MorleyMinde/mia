<section class="space-y-4 p-4">
  <div class="space-y-2">
    <h2 class="text-xl font-semibold text-ink">Search Patients</h2>
    <p class="text-sm text-muted">Type a patient's name to search and select them.</p>
  </div>

  <div class="space-y-3">
    <div class="relative">
      <input 
        type="text" 
        [formControl]="searchControl" 
        class="input pl-10" 
        placeholder="Search by patient name..."
        autocomplete="off">
      <span class="absolute left-3 top-1/2 -translate-y-1/2 text-xl">ğŸ”</span>
    </div>

    <p class="text-xs text-danger" *ngIf="errorMessage()">{{ errorMessage() }}</p>
    
    <p class="text-xs text-muted text-center" *ngIf="searching()">
      Searching...
    </p>
  </div>

  <!-- Search Results / Linked Patients -->
  <div class="space-y-2" *ngIf="displayedPatients().length; else emptyState">
    <p class="text-xs text-muted uppercase tracking-wide px-2" *ngIf="searchControl.value && searchControl.value.length >= 2">
      Search Results
    </p>
    
    <article 
      *ngFor="let patient of displayedPatients()" 
      class="rounded-2xl bg-surface px-4 py-4 shadow-md border border-border/40 hover:shadow-lg transition-shadow cursor-pointer flex items-center justify-between gap-4"
      (click)="selectPatient(patient)">
      <div class="flex items-center gap-3 flex-1 min-w-0">
        <div class="w-12 h-12 rounded-xl bg-brand-gradient flex items-center justify-center text-white font-bold text-lg flex-shrink-0">
          {{ patient.displayName[0] }}
        </div>
        <div class="min-w-0 flex-1">
          <p class="text-lg font-semibold text-ink truncate">{{ patient.displayName }}</p>
          <p class="text-xs text-muted">
            <span *ngIf="patient.yearOfBirth">Age {{ getAge(patient.yearOfBirth) }}</span>
            <span *ngIf="patient.yearOfBirth && patient.conditions?.length"> Â· </span>
            <span *ngIf="patient.conditions?.length">{{ patient.conditions.join(', ') }}</span>
          </p>
        </div>
      </div>
      <button 
        type="button" 
        class="pill-button text-sm px-4 py-2 flex-shrink-0" 
        (click)="selectPatient(patient); $event.stopPropagation()">
        Select
      </button>
    </article>
  </div>

  <ng-template #emptyState>
    <div class="rounded-2xl border border-dashed border-border/70 p-8 text-center text-muted space-y-2 mt-8">
      <span class="text-4xl block">ğŸ‘¥</span>
      <p class="font-semibold" *ngIf="!searchControl.value">Start typing to search</p>
      <p class="font-semibold" *ngIf="searchControl.value && searchControl.value.length < 2">
        Type at least 2 characters
      </p>
      <p class="font-semibold" *ngIf="searchControl.value && searchControl.value.length >= 2 && !searching()">
        No patients found
      </p>
      <p class="text-sm">Search for patients by their name</p>
    </div>
  </ng-template>
</section>
